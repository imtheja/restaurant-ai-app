# ðŸ”„ Restaurant AI - Flow Diagrams

## 1. Complete System Flow

```mermaid
graph TB
    subgraph "Client Browser"
        A[User] -->|Clicks Avatar| B[Show Microphone]
        B -->|Clicks Mic| C[Speech Recognition]
        C -->|Voice to Text| D[JavaScript Handler]
        D -->|Fetch API| E[POST /api/chat]
        
        Z[Menu Display] -->|Filter/Click| Y[Update UI]
    end
    
    subgraph "Python Server"
        E -->|HTTP Request| F[RestaurantHandler]
        F -->|Route| G[_handle_chat]
        G -->|Process| H[IntelligentAI]
        
        H -->|Check Config| I{AI Available?}
        I -->|Yes| J[AI Service API]
        I -->|No| K[Fallback Rules]
        
        J -->|Response| L[Format Response]
        K -->|Response| L
        L -->|JSON| M[Send Response]
    end
    
    subgraph "External Services"
        J -->|HTTPS| N[Groq/OpenAI]
        N -->|AI Response| J
    end
    
    M -->|HTTP Response| O[JavaScript]
    O -->|Update Chat| P[Display Message]
    O -->|Extract Recs| Q[Show Recommendations]
    O -->|Text to Speech| R[Sophie Speaks]
```

## 2. Voice Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚     â”‚   Browser   â”‚     â”‚   Server    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚                    â”‚
      â”‚ Click Sophie ðŸ‘©â€ðŸ’¼   â”‚                    â”‚
      â”‚------------------->â”‚                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ See Microphone ðŸŽ¤  â”‚                    â”‚
      â”‚<-------------------|                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ Click & Speak      â”‚                    â”‚
      â”‚------------------->â”‚                    â”‚
      â”‚                    â”‚ Start Recording    â”‚
      â”‚                    â”‚ (Web Speech API)   â”‚
      â”‚                    â”‚                    â”‚
      â”‚ "I'm hungry"       â”‚                    â”‚
      â”‚------------------->â”‚                    â”‚
      â”‚                    â”‚ Convert to Text    â”‚
      â”‚                    â”‚                    â”‚
      â”‚                    â”‚ Send Message       â”‚
      â”‚                    |------------------->â”‚
      â”‚                    â”‚                    â”‚ Process with AI
      â”‚                    â”‚                    â”‚ 
      â”‚                    â”‚ Response + Recs    â”‚
      â”‚                    â”‚<-------------------|
      â”‚                    â”‚                    â”‚
      â”‚ Show Message       â”‚                    â”‚
      â”‚<-------------------|                    â”‚
      â”‚                    â”‚                    â”‚
      â”‚ Hear Sophie        â”‚                    â”‚
      â”‚<-------------------| (Text to Speech)  â”‚
      â”‚                    â”‚                    â”‚
```

## 3. AI Processing Pipeline

```
User Message: "Something spicy"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conversation Historyâ”‚
â”‚ + System Prompt     â”‚
â”‚ + User Message      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI API Request    â”‚
â”‚ â€¢ Model: llama3-70b â”‚
â”‚ â€¢ Max tokens: 80    â”‚
â”‚ â€¢ Temperature: 0.8  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Response       â”‚
â”‚ "Yes! ðŸ”¥ Thai curry â”‚
â”‚ brings the heat -   â”‚
â”‚ you'll love it!"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extract Menu Items  â”‚
â”‚ â€¢ Thai Red Curry    â”‚
â”‚ â€¢ Match by name     â”‚
â”‚ â€¢ Return full data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Final Response    â”‚
â”‚ â€¢ Message (text)    â”‚
â”‚ â€¢ Recommendations   â”‚
â”‚ â€¢ Timestamp         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. Menu Filtering Flow

```
User Action: Click "Vegetarian" checkbox
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Update AppState  â”‚
         â”‚ vegetarian: true â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ filterMenuItems()â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        Apply Filters          â”‚
    â”‚ â€¢ Category: current           â”‚
    â”‚ â€¢ Vegetarian: âœ“               â”‚
    â”‚ â€¢ Vegan: âœ—                    â”‚
    â”‚ â€¢ Gluten-free: âœ—              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Filter Results    â”‚
         â”‚ â€¢ Quinoa Bowl     â”‚
         â”‚ â€¢ Caesar Salad    â”‚
         â”‚ â€¢ Bruschetta      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ renderMenuItems() â”‚
         â”‚ Update DOM        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Error Handling Flow

```
                  API Call Fails
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ HTTP Error / Timeout â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Log Error Details â”‚
            â”‚ â€¢ Error code      â”‚
            â”‚ â€¢ Stack trace     â”‚
            â”‚ â€¢ User message    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Fallback Decision â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rule-based       â”‚       â”‚ Error Message    â”‚
â”‚ Response         â”‚       â”‚ to User          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Send Response     â”‚
            â”‚ Continue Flow     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Speech Synthesis Flow

```
AI Response Text: "Yes! ðŸ”¥ Thai curry brings the heat!"
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Clean Text for Speechâ”‚
                 â”‚ â€¢ Remove emojis      â”‚
                 â”‚ â€¢ ðŸ”¥ â†’ ""            â”‚
                 â”‚ â€¢ ðŸ˜‹ â†’ "mmm"         â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Create Utterance      â”‚
                 â”‚ â€¢ Rate: 0.95         â”‚
                 â”‚ â€¢ Pitch: 1.2         â”‚
                 â”‚ â€¢ Volume: 0.9        â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Select Voice          â”‚
                 â”‚ Priority:             â”‚
                 â”‚ 1. Samantha (iOS)     â”‚
                 â”‚ 2. Zira (Windows)     â”‚
                 â”‚ 3. Female voices      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ speechSynthesis.speak â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Audio Output          â”‚
                 â”‚ "Yes! Thai curry      â”‚
                 â”‚  brings the heat!"    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. Logging Flow

```
Request Received
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Log Request Infoâ”‚
â”‚ â€¢ Method        â”‚
â”‚ â€¢ Path          â”‚
â”‚ â€¢ Client IP     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process Request â”‚
â”‚ â€¢ Log steps     â”‚
â”‚ â€¢ Time tracking â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â”€â”€â”€ Success Path â”€â”€â”€â”€â”
      â”‚                      â”‚
      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Log Success     â”‚    â”‚ Log Error       â”‚
â”‚ â€¢ Response time â”‚    â”‚ â€¢ Exception     â”‚
â”‚ â€¢ Status code   â”‚    â”‚ â€¢ Stack trace   â”‚
â”‚ â€¢ Data size     â”‚    â”‚ â€¢ Context       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Write to:       â”‚
         â”‚ â€¢ Console       â”‚
         â”‚ â€¢ restaurant_ai.log â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

These diagrams illustrate the complete flow of data and control through the Restaurant AI application, from user interaction to AI processing and response delivery.